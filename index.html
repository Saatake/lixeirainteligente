<script type="text/javascript">
  var apiKey = "HMKMBEFQ5VFKUD4A"; // Substitua com sua Read API Key do ThingSpeak
  var channelID = "2557355";  // Substitua com seu Channel ID do ThingSpeak

  function getLevelText(distance) {
    if (distance > 14) {
      return "<span class='green'>Nenhum lixo</span>";
    } else if (distance > 11) {
      return "<span class='yellow'>Pouco lixo</span>";
    } else if (distance > 7) {
      return "<span class='orange'>Bastante lixo</span>";
    } else {
      return "<span class='red'>Muito lixo</span>";
    }
  }

  function fetchData() {
    var url = `https://api.thingspeak.com/channels/${channelID}/fields/1/last.json?api_key=${apiKey}`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        console.log("Dados recebidos do ThingSpeak:", data);
        if (data.created_at) {
          var lastUpdate = new Date(data.created_at);
          var now = new Date();
          var diffMinutes = Math.floor((now - lastUpdate) / (1000 * 60)); // Diferença em minutos
          if (diffMinutes > 2) {
            document.getElementById('level').innerHTML = "Sem atualizações recentes";
          } else {
            var level = parseInt(data.field1); // Converter para inteiro
            var levelText = getLevelText(level);
            document.getElementById('level').innerHTML = levelText;
          }
        }
      })
      .catch(error => console.error('Erro ao buscar dados:', error));
  }

  // Fetch data on page load
  fetchData();

  // Fetch data every 15 seconds
  setInterval(fetchData, 15000);
</script>
